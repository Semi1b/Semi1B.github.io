<script>
    const player = document.getElementById('player');
    const gameArea = document.getElementById('game-area');
    const tileSize = 30; // Blokken en speler zijn 30x30 pixels

    // De wereldkaart. 0 = lucht, 1 = gras/aarde, 2 = steen
    // De game-area is 600px breed (20 kolommen) en 400px hoog (13 rijen).
    const world = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0], // Een grasplatform
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0], // Een stenen platform
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]  // De grond (gras)
    ];

    let playerX = tileSize * 2; // Startpositie X
    let playerY = 0; // Startpositie Y (Bovenin)
    let velocityY = 0; // Verticale snelheid (voor zwaartekracht/springen)
    const gravity = 1; 
    const jumpPower = -15; 
    const moveSpeed = 5;
    let currentDirection = null; // 'left' of 'right'
    let isJumping = false;
    let isOnGround = false; // Nieuwe vlag voor zwaartekracht
    const playerSize = tileSize;

    // --- FUNCTIES VOOR DE WERELD ---

    // Teken alle blokken in de wereld (De code die je al had)
    function drawWorld() {
        // Verwijder alleen de oude tegels
        document.querySelectorAll('.tile').forEach(tile => tile.remove()); 
        
        for (let y = 0; y < world.length; y++) {
            for (let x = 0; x < world[y].length; x++) {
                const blockType = world[y][x];
                if (blockType > 0) {
                    const block = document.createElement('div');
                    block.className = 'tile';
                    block.style.position = 'absolute';
                    block.style.width = tileSize + 'px';
                    block.style.height = tileSize + 'px';
                    block.style.left = (x * tileSize) + 'px';
                    block.style.top = (y * tileSize) + 'px';
                    block.style.border = '1px solid'; // Algemene rand

                    // Kleur bepalen op basis van bloktype
                    if (blockType === 1) { // Gras
                        block.style.backgroundColor = '#388E3C'; 
                        block.style.borderColor = '#1B5E20';
                    } else if (blockType === 2) { // Steen
                        block.style.backgroundColor = '#607D8B'; 
                        block.style.borderColor = '#455A64';
                    }

                    gameArea.appendChild(block);
                }
            }
        }
    }

    // Controleer of de gegeven (x, y) co√∂rdinaat van een tegel een vast blok is.
    function isSolid(tileX, tileY) {
        if (tileY < 0 || tileY >= world.length || tileX < 0 || tileX >= world[0].length) {
            return false; // Buiten de grenzen van de wereld
        }
        return world[tileY][tileX] > 0;
    }

    // --- FUNCTIES VOOR DE SPELER ---

    // Controleer op botsingen (De code die je was begonnen, maar nu afgemaakt)
    function checkCollision(x, y) {
        // Bereken welke tegels de speler overlapt of raakt
        const leftTile = Math.floor(x / tileSize);
        const rightTile = Math.floor((x + playerSize - 1) / tileSize); // -1 voor de rand
        const topTile = Math.floor(y / tileSize);
        const bottomTile = Math.floor((y + playerSize) / tileSize);

        // Horizontale botsing (alleen nodig als de speler beweegt, maar controleren we nu preventief)
        for (let row = topTile; row <= bottomTile; row++) {
            if (isSolid(leftTile, row) || isSolid(rightTile, row)) {
                // We behandelen horizontale botsingen in de gameUpdate functie
                // Deze functie focus nu vooral op of er iets onder de speler is (isOnGround).
                // Om de code simpel te houden, richten we ons primair op verticale botsingen (vloer/plafond).
            }
        }

        // Verticale botsing (Controleer de tegel direct onder de speler voor de 'grond')
        // We controleren de tegel een pixel onder de huidige positie
        const tileUnderPlayer = Math.floor((y + playerSize + 1) / tileSize);
        
        // Controleer of de speler op *een* vast blok staat (links of rechts onder)
        isOnGround = isSolid(leftTile, tileUnderPlayer - 1) || isSolid(rightTile, tileUnderPlayer - 1);
        
        return {
            bottom: isSolid(leftTile, bottomTile) || isSolid(rightTile, bottomTile),
            top: isSolid(leftTile, topTile) || isSolid(rightTile, topTile),
            left: isSolid(leftTile, topTile) || isSolid(leftTile, bottomTile - 1), // -1 voor de hoek
            right: isSolid(rightTile, topTile) || isSolid(rightTile, bottomTile - 1),
            // Een simplistische manier om *√©√©n* van de tegels onder de speler te vinden
            groundY: isOnGround ? (tileUnderPlayer - 1) * tileSize : null 
        };
    }

    // Speler springen
    function jump() {
        // Alleen springen als de speler op de grond staat
        if (isOnGround) {
            velocityY = jumpPower;
            isOnGround = false; // Je bent nu in de lucht!
            // Emoei toevoegen!
            player.style.backgroundColor = '#1A237E'; // Even een blauwe kleur tijdens het springen üíô
        }
    }

    // Speler bewegen (ingedrukt houden)
    function movePlayer(direction) {
        currentDirection = direction;
    }

    // Speler stoppen (loslaten)
    function stopPlayer() {
        currentDirection = null;
    }
    
    // De hoofd-gamelus (loopt constant)
    function gameUpdate() {
        // 1. Horizontale beweging
        let newX = playerX;
        if (currentDirection === 'left') {
            newX = playerX - moveSpeed;
        } else if (currentDirection === 'right') {
            newX = playerX + moveSpeed;
        }

        // Blijf binnen de game-area (600px breed)
        if (newX >= 0 && newX + playerSize <= 600) {
            // Voer een voorlopige botsingscheck uit voor de nieuwe X-positie
            const collision = checkCollision(newX, playerY);

            // Controleer op horizontale botsing met blokken
            if ((currentDirection === 'left' && !collision.left) || (currentDirection === 'right' && !collision.right)) {
                 playerX = newX;
            } 
            // Een meer geavanceerde check zou hier nodig zijn om de speler netjes tegen de rand van het blok te plaatsen.
            // Voor nu houden we het simpel: als je op een blok botst, beweeg je niet.
        }
        
        // 2. Verticale beweging (Zwaartekracht & Sprongen)
        
        // Pas zwaartekracht toe
        velocityY += gravity;
        
        // Beperk verticale snelheid (max. val)
        if (velocityY > tileSize) velocityY = tileSize;
        
        let newY = playerY + velocityY;

        // Blijf binnen de game-area (400px hoog)
        if (newY + playerSize >= 400) {
