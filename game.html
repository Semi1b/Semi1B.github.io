<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Minecraft/Terraria Webgame</title>
    
    <style>
        /* CSS for styling */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            color: #1A237E;
            text-align: center;
        }
        
        h1 {
            color: #1A237E;
            margin-top: 20px;
        }

        #game-area {
            border: 4px solid #FFC107; 
            height: 400px; 
            width: 600px; 
            margin: 20px auto; 
            position: relative; 
            overflow: hidden; 
            background-color: #79a6d9; /* Sky background */
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
        }

        #player {
            position: absolute; 
            width: 30px; 
            height: 30px; 
            background-color: #388E3C; 
            transition: background-color 0.1s; 
        }

        .controls button {
            transition: background-color 0.1s;
        }
        
        .controls button:active {
             background-color: #ff9800 !important; 
        }
    </style>
</head>
<body>
    <hr>
    
    <h1>⛏️ Minecraft/Terraria Style Game</h1>
    <p>Welcome to your 2D world! Use **W/A/D** (or the spacebar) or the buttons to move and jump.</p>

    <div id="game-area">
        <div id="player"></div>
    </div>
    
    <div id="controls" class="controls" style="text-align: center; margin-top: 10px;">
        <button onmousedown="jump()" ontouchstart="jump()" style="width: 80px; height: 35px; background-color: #FFC107; color: #1A237E; border: none; display: block; margin: 0 auto 10px; font-weight: bold; cursor: pointer; border-radius: 5px;">▲ Jump</button>
        <div style="display: flex; justify-content: center;">
            <button onmousedown="movePlayer('left')" ontouchstart="movePlayer('left')" ontouchend="stopPlayer()" onmouseup="stopPlayer()" style="width: 80px; height: 35px; background-color: #FFC107; color: #1A237E; border: none; margin-right: 10px; font-weight: bold; cursor: pointer; border-radius: 5px;">◀ Left</button>
            <button onmousedown="movePlayer('right')" ontouchstart="movePlayer('right')" ontouchend="stopPlayer()" onmouseup="stopPlayer()" style="width: 80px; height: 35px; background-color: #FFC107; color: #1A237E; border: none; font-weight: bold; cursor: pointer; border-radius: 5px;">▶ Right</button>
        </div>
    </div>

    <script>
        const player = document.getElementById('player');
        const gameArea = document.getElementById('game-area');
        const tileSize = 30; // Blocks and player are 30x30 pixels
        
        // The world map. 0 = air, 1 = grass/dirt, 2 = stone
        const world = [
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0], // Grass platform
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0], // Stone platform
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]  // The ground
        ];

        let playerX = tileSize * 2; 
        let playerY = 0; 
        let velocityY = 0; 
        const gravity = 1; 
        const jumpPower = -15; 
        const moveSpeed = 5;
        let currentDirection = null; 
        let isOnGround = false; 
        const playerSize = tileSize;
        let jumpInputActive = false; // NEW: Flag to control keyboard jump frequency

        // Draw all blocks in the world
        function drawWorld() {
            document.querySelectorAll('.tile').forEach(tile => tile.remove()); 
            
            for (let y = 0; y < world.length; y++) {
                for (let x = 0; x < world[y].length; x++) {
                    const blockType = world[y][x];
                    if (blockType > 0) {
                        const block = document.createElement('div');
                        block.className = 'tile';
                        block.style.position = 'absolute';
                        block.style.width = tileSize + 'px';
                        block.style.height = tileSize + 'px';
                        block.style.left = (x * tileSize) + 'px';
                        block.style.top = (y * tileSize) + 'px';
                        block.style.border = '1px solid';

                        if (blockType === 1) { // Grass
                            block.style.backgroundColor = '#388E3C'; 
                            block.style.borderColor = '#1B5E20';
                        } else if (blockType === 2) { // Stone
                            block.style.backgroundColor = '#607D8B'; 
                            block.style.borderColor = '#455A64';
                        }

                        gameArea.appendChild(block);
                    }
                }
            }
        }

        // Check if the tile is a solid block
        function isSolid(tileX, tileY) {
            if (tileY < 0 || tileY >= world.length || tileX < 0 || tileX >= world[0].length) {
                return false; 
            }
            return world[tileY][tileX] > 0;
        }

        // Check for collisions
        function checkCollision(x, y) {
            const leftTile = Math.floor(x / tileSize);
            const rightTile = Math.floor((x + playerSize - 1) / tileSize); 
            const topTile = Math.floor(y / tileSize);
            const bottomTile = Math.floor((y + playerSize - 1) / tileSize);

            // Check the tile directly under the player
            const tileUnderPlayer = Math.floor((y + playerSize + 1) / tileSize);
            isOnGround = isSolid(leftTile, tileUnderPlayer - 1) || isSolid(rightTile, tileUnderPlayer - 1);
            
            return {
                bottom: isSolid(leftTile, bottomTile) || isSolid(rightTile, bottomTile),
                top: isSolid(leftTile, topTile) || isSolid(rightTile, topTile),
                left: isSolid(leftTile, topTile) || isSolid(leftTile, bottomTile),
                right: isSolid(rightTile, topTile) || isSolid(rightTile, bottomTile),
                groundY: isOnGround ? (tileUnderPlayer - 1) * tileSize : null 
            };
        }

        // Player jump
        function jump() {
            if (isOnGround) {
                velocityY = jumpPower;
                isOnGround = false; 
                player.style.backgroundColor = '#1A237E'; // Blue while jumping 
            }
        }

        // Player move (button held down)
        function movePlayer(direction) {
            currentDirection = direction;
        }

        // Player stop (button released)
        function stopPlayer() {
            currentDirection = null;
        }
        
        // The main game loop
        function gameUpdate() {
            // 1. Horizontal movement
            let newX = playerX;
            if (currentDirection === 'left') {
                newX = playerX - moveSpeed;
            } else if (currentDirection === 'right') {
                newX = playerX + moveSpeed;
            }

            // Keep inside the game area
            if (newX >= 0 && newX + playerSize <= 600) {
                const collision = checkCollision(newX, playerY);
                // Check for horizontal collision
                if ((currentDirection === 'left' && !collision.left) || (currentDirection === 'right' && !collision.right)) {
                     playerX = newX;
                } else if (currentDirection === 'left' && collision.left) {
                     playerX = (Math.floor(playerX / tileSize) + 1) * tileSize; 
                } else if (currentDirection === 'right' && collision.right) {
                     playerX = (Math.floor(playerX / tileSize) * tileSize) - playerSize; 
                }
            }
            
            // 2. Vertical movement (Gravity & Jumps)
            velocityY += gravity;
            if (velocityY > tileSize) velocityY = tileSize;
            let newY = playerY + velocityY;

            // Check collision with the bottom of the game area (the floor)
            if (newY + playerSize >= 400) { 
                newY = 400 - playerSize;
                velocityY = 0;
                isOnGround = true;
            } else {
                // Check for collision with world blocks
                const collision = checkCollision(playerX, newY);
                
                if (collision.bottom && velocityY > 0) { // Collision with ground while falling
                    if (collision.groundY !== null) {
                        newY = collision.groundY - playerSize; 
                    } else {
                        newY = Math.floor(newY / tileSize) * tileSize - playerSize;
                    }
                    velocityY = 0;
                    isOnGround = true;
                } 
                
                if (collision.top && velocityY < 0) { // Collision with ceiling while jumping
                    velocityY = 0; 
                    newY = Math.floor(newY / tileSize) * tileSize + tileSize; 
                }
            }

            // Update player position and status
            playerY = newY;
            player.style.left = playerX + 'px';
            player.style.top = playerY + 'px';
            
            if (isOnGround) {
                player.style.backgroundColor = '#388E3C'; // Green color
            }

            requestAnimationFrame(gameUpdate);
        }
        
        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (e.key === 'a' || e.key === 'A') {
                movePlayer('left');
            } else if (e.key === 'd' || e.key === 'D') {
                movePlayer('right');
            } 
            // FIX: Only call jump() once when the key is pressed, not repeatedly
            else if ((e.key === 'w' || e.key === 'W' || e.key === ' ') && isOnGround && !jumpInputActive) {
                jump();
                jumpInputActive = true; // Set flag to prevent immediate re-jump
            }
        });

        document.addEventListener('keyup', (e) => {
            if ((e.key === 'a' || e.key === 'A') && currentDirection === 'left') {
                stopPlayer();
            } else if ((e.key === 'd' || e.key === 'D') && currentDirection === 'right') {
                stopPlayer();
            }
            // FIX: Reset flag when jump key is released
            else if (e.key === 'w' || e.key === 'W' || e.key === ' ') {
                jumpInputActive = false;
            }
        });

        // Start the world and the game loop
        drawWorld();
        gameUpdate(); 
    </script>
</body>
</html>
